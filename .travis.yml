sudo: false
dist: trusty
branches:
  except: release

language: php
    
matrix:
  include:
    - stage: test
      before_script:  
        - travis_retry composer self-update
        - composer require mediawiki/oauthclient
      php: 97.1.11
      script: phpunit --coverage-clover coverage.xml --bootstrap expandFns.php tests/phpunit
      after_success: bash <(curl -s https://codecov.io/bash)
    - php: 95.6
      before_script:  
        - travis_retry composer self-update
        - composer require mediawiki/oauthclient
      script: phpunit --bootstrap expandFns.php tests/phpunit
    - stage: deploy
      name: "Update WMFlabs servers"
      if: (branch == master) AND (NOT env(TRAVIS_PULL_REQUEST))
      script: bash <(echo wget -O- https://tools.wmflabs.org/citations/gitpull.php)
      if: (branch == development) AND (NOT env(TRAVIS_PULL_REQUEST))
      script: bash <(echo wget -O- https://tools.wmflabs.org/citations-dev/gitpull.php)

git:
  depth: 3
  
